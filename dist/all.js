define(["jquery","config","statusTodo","template","todo","pagenation"],function(e,t,o,a,i,n){function s(e){f=[],i.loadTodoByPage(e.index,3).done(function(e){var t=e.length;if(t>0){for(var o=0;t>o;++o){var i=e[o],n={id:i.id,todo:i.todo,completed:!!i.completed};f.push(n)}a.compileTemplate(f),u()}})}function d(e){var o=e.keyCode;if(o==t.ENTER_KEY){var a=$(m.NEW_TODO),n=a.val();i.saveTodo(n).done(function(e){l(e.insertId,n),a.val("")})}}function l(e,t,o){f.unshift({id:e,todo:t,completed:!!o}),a.compileTemplate(f),u()}function c(e){var t=$(e.target),o=t.closest("li"),a=o.data("id"),n=o.hasClass("completed")?0:1;i.completeTodo(a,n).done(function(){o.toggleClass("completed"),u()})}function r(e){var t=$(e.target),o=t.closest("li"),a=o.data("id");i.deleteTodo(a).done(function(){o.remove();var e=f.indexOf(f.find(function(e){return e.id==a}));f.splice(e,1),u()})}function u(){var e=$(m.TODO_LIST+" li.view:not(.completed)").length;$(m.TODO_COUNT).text(e)}var h,m=t.SELECTOR,f=[];return{init:function(){$(m.NEW_TODO).on("keydown",d),$(m.TODO_LIST).on("click",".toggle",c),$(m.TODO_LIST).on("click",".destroy",r),i.getAllCount().done(function(e){h=new n($(m.PAGEBAR),Math.ceil(e.cnt/3),1,5),h.on("move",s)}),s({index:1,max:0})}}}),define(function(){return{ENTER_KEY:13,SELECTOR:{TODO_LIST:".todo-list",NEW_TODO:".new-todo",TODO_COUNT:".todo-count strong",TODO_TEMPLATE:"#todo-template",FILTER:".filters a",PAGEBAR:".pagebar"}}}),define(["jquery","eventemitter"],function(e,t){function o(o,a,i,n){this.maxPage=a,this.nowPage=i||1,this.limit=n||5,this.ele=e(o),this.ee=new t,this.init()}return o.prototype={init:function(){this.ele.on("click","a",e.proxy(this,"clickPage")),this.setPageButton(),this.ee.emit("move",{index:this.nowPage,max:this.maxPage})},setPageButton:function(){this.ele.empty();var t=Math.ceil(this.nowPage/this.limit),o=5*(t-1)+1,a=t*this.limit;a>this.maxPage&&(a=this.maxPage);var i=[];i.push(e('<a href="#">&lt;&lt;</a>')[this.nowPage<=this.limit?"addClass":"removeClass"]("disabled")),i.push(e('<a href="#">&lt;</a>')[1==this.nowPage?"addClass":"removeClass"]("disabled"));for(var n=o;a>=n;++n){var s=e('<a href="#">'+n+"</a>")[this.nowPage==n?"addClass":"removeClass"]("selected");i.push(s)}i.push(e('<a href="#">&gt;</a>')[this.nowPage==this.maxPage?"addClass":"removeClass"]("disabled")),i.push(e('<a href="#">&gt;&gt;</a>')[this.nowPage>this.maxPage-this.limit?"addClass":"removeClass"]("disabled")),this.ele.append(i)},clickPage:function(t){var o=e(t.target),a=o.text();o.hasClass("disabled")||o.hasClass("disabled")||("<"==a?a=--this.nowPage:">"==a?a=++this.nowPage:"<<"==a?(this.nowPage-=this.limit,a=this.nowPage):">>"==a?(this.nowPage=1*this.nowPage+this.limit,a=this.nowPage):this.nowPage=a,this.setPageButton(),this.ee.emit("move",{index:this.nowPage,max:this.maxPage}))},on:function(e,t){this.ee.on(e,t)},off:function(e,t){this.ee.off(e,t)},getPage:function(){return this.nowPage},getMaxPage:function(){return this.maxPage}},o}),define(["config"],function(e){e.SELECTOR;return{init:function(){}}}),define(["handlebars","config"],function(e,t){function o(){e.registerPartial("todoList",'<{{tagName}} class="view {{#completed}}completed{{/completed}}" data-id={{id}}><div class="view"><input class="toggle" type="checkbox" {{#completed}}checked{{/completed}}><label>{{todo}}</label><button class="destroy"></button></div><input class="edit" value="{{todo}}"></{{tagName}}>')}var a=t.SELECTOR;return{compileTemplate:function(t){o();var i=$(a.TODO_TEMPLATE).html(),n=e.compile(i);return this.compileTemplate=function(e){$(a.TODO_LIST).empty().append(n({todos:e}))},this.compileTemplate(t)}}}),define(function(){var e="cca-company",t="http://128.199.76.9:8002/:"+e+"/";return{saveTodo:function(o){return $.ajax({url:t,method:"POST",data:{nickname:e,todo:o}})},loadTodo:function(){return $.ajax({url:t,method:"GET",data:{nickname:e}})},deleteTodo:function(o){return $.ajax({url:t+o,method:"DELETE",data:{nickname:e,id:o}})},completeTodo:function(o,a){return $.ajax({url:t+o,method:"PUT",data:{nickname:e,id:o,completed:a?1:0}})},getAllCount:function(){return $.ajax({url:t+"count",method:"GET"})},loadTodoByPage:function(e,o){return $.ajax({url:t+"page",method:"GET",data:{start:3*(e-1),limit:o}})}}});